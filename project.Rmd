---
title: "Building a Hotel Booking Cancellation Prediction Model"
subtitle: "Using Machine Learning Models to Predict Whether a Hotel Guest would Cancel their Hotel Booking"
author: "Giselle Ramirez"
subtitle: "UCSB Fall 2022"
output: html_document
date: "2022-12-06"
---

![](hotelbookingpic.jpg)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

The purpose of this project is to build machine learning models that can accurately predict whether a hotel guest would cancel their hotel booking. The data that would be used is from 'hotel_booking', and I will build different models that would most accurately predict the binary regression problem.

## Hotel Booking Process

Guests from all over the world are visiting hotels for different reasons. It could range to personal vacation ventures to business trips. In order to book a hotel, the guest must provide information about themselves and what kind of booking they are looking for. For example, they need to provide information on what day and how long they are looking to book the room(s). Also, who is coming along with them, along with other personal information they are looking to get from the hotel, such as parking and special accommodations. Hotels keep track of this and save the guest the room they asked for. However, there are times for any reason where hotel guests cancel their reservation. Hotels, in this case, must cancel the booking for the guest.

```{r}
library(vembedr)
embed_youtube("oUv2BcxAvjQ")
```

## **Why is this model important?**

In this dataset, we are exploring only two hotels: Resort Hotel and City Hotel, which are the closest hotels in the area. In order to keep track of when and if hotel guests will check in, it's important to keep track of hotel booking cancellations. Also, we need to see if certain guest traits will have a higher chance of cancellation so that hotels can be prepared just in case there might be a cancellation.

## **Project Roadmap**

\<insert what models were used\>

## Exploratory Data Analysis

We need to clean up the data and choose our important variables that are relevant to predicting hotel booking cancellation.

### Loading Packages and Data

The dataset was found on Kaggle from Jeese Mostipak, but the [hotel_booking](https://www.kaggle.com/datasets/jessemostipak/hotel-booking-demand) dataset was originally found from an article "Hotel Booking Demand Datasets" by Nuno Antonio, Ana Almedia, and Luis Nunes 2018. The original dataset contains 119390 observations/guests with 32 variables.

However, I will only use the variables that I believe are relevant to predicting hotel booking cancellations. In our case, is_canceled is our response variable, while the other variables are the predictors:

-   hotel: Which hotel --\> H1 = Resort Hotel or H2 = City Hotel
-   is_canceled: Whether hotel guest cancelled (1) or didn't cancel (0)
-   lead_time: Number of days hotel guest booked reservation in advance
-   arrival_date_year: Year of arrival
-   arrival_date_month: Month of arrival
-   arrival_date_week: Week of arrival (out of 52 weeks in a year)
-   arrival_date_day_of_month: Number of day in a Month
-   stays_in_weekend_nights: How many weekend nights (Saturday and Sunday) hotel guest stayed over
-   stays_in_week_nights: How many week nights (Monday to Friday)
-   adults: Number of adults checking in
-   children: Number of children checking in
-   babies: Number of babies checking in
-   meal: Type of meal package ordered (Undefined/SC - no meal package, BB - Bed and Breakfast, HB - Half board (two meals a day), FB - Full board (three meals a day))
-   country: Which country guest comes from (format: ISO 3155-3:2013), e.g. PRT = Portugal
-   market_segment: How people ordered their hotel booking (Online TA (Travel Agent), Offline TA/TO (Tour Operator), Direct, Corporate, Complementary, Groups, Undefined, Aviation)
-   distribution_channel: How booking was reserved (Direct, Corporate, TA/TO, Undefined, GDS)
-   is_repeated_guest: Not the first time the hotel guest made another hotel booking (1) or first time hotel guest (0)
-   previous_cancellations: Number of previous cancellations by guest before current hotel booking
-   previous_booking_not_cancelled: Number of previous hotel bookings by guest NOT CANCELLED before current hotel booking
-   reserved_room_type: Type of room reserved (C, A, D, E, G, F, H, L, P, B)
-   `assigned_room_type`: Type of room assigned (may differ due to overbooking or room upgrades) (C, A, D, E, G, F, H, L, P, B, I, K)
-   `booking_changes`: Number of hotel booking changes when room(s) were booked until checkout
-   deposit_type: If hotel guest left deposit ("No Deposit" - none made, "Refundable" - deposit made was worth less of hotel stay, "Non Refund" - deposit made was made of entire hotel stay cost)
-   agent: Identification of travel agency that reserved hotel booking for guest
-   company: Identification of company that made booking
-   days_in_waiting_list: Number of days on waitlist before getting accepted to a hotel booking reservation
-   customer_type: Type of booking made (Transient - short and urgent booking for individual, Contract - signed contract for long stay booking, Transient-Party - short and urgent booking for a group, Group - booking for a group)
-   adr: Average Daily Rate (total cost of booking divided by number of days)
-   required_car_parking_spaces: Number of car parking spaces reserved by hotel guest
-   total_of_special_request: Number of total special requests made by hotel guest
-   reservation_status: Final reservation status (Check-Out - Hotel guest checked in and left at end of reservation booking, Canceled - hotel booking cancelled, No-Show - never showed up)
-   reservation_status_date: Date of final reservation status

### Libraries and Dataset Cleaning

```{r}
library(tidymodels)
library(tidyverse)
library(dplyr)
library(corrr)
library(corrplot)
library(ggplot2)
library(discrim)
library(klaR)
library(glmnet)
library(ISLR)
library(rpart.plot)
library(vip)
library(randomForest)
library(xgboost)
library(ranger)
library(tidyr)
library(janitor)
library(knitr)
library(MASS)
library(vembedr)
library(yardstick)
tidymodels_prefer()
hotel_booking <- read.csv("hotel_bookings.csv")
set.seed(1234)
hotel_booking %>%
  head()
```

Let's see the dimensions of this dataset.

```{r}
dim(hotel_booking)
```

So we have 119390 individuals that booked hotel reservations and 32 original variables.

Let's see which variables have missing values so that we could remove the ones that have over 40% missing

```{r}
numeric_book <- unlist(lapply(hotel_booking, is.integer))
data_num <- hotel_booking[, numeric_book]
#data_num
(colMeans(is.na(data_num))) *100

character_book <- unlist(lapply(hotel_booking, is.character))
data_chara <- hotel_booking[, character_book]
(colMeans(is.null(data_chara))) * 100
sum(is.na(hotel_booking$children)) #4 missing

#count by group

null_country <- data_chara %>%
  group_by(country) %>%
  summarize(n()) %>%
  filter(country == "NULL") %>%
  select('n()')
null_country #488

null_agent <- data_chara %>%
  group_by(agent) %>%
  summarize(n()) %>%
  filter(agent == "NULL") %>%
  select('n()')
null_agent #16340

null_comp <- data_chara %>%
  group_by(company) %>%
  summarize(n()) %>%
  filter(company == "NULL") %>%
  select('n()')
null_comp #112593


```

```{r}

```

drop: company, adults, babies, children, deposit_type, reservation_status_date, total_nights, arrivial_date_week_number, stays_in_weekend_nights, arrivial_date_month, agent, arrivial_date_week_number, statys_in_weekend_nights, arrivial_date_month,

drop: children, adults, and babies (that are all this at same time)

days_in_waiting_list, arrivial_date_year, arrival_date_year, assigned_room_type, booking changes, reservation_status, country, days_in_waiting_list,

reservation_status_date (after saving year, month, and day separately), arrival_date_month
